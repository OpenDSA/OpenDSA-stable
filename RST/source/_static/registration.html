<html>
<head>
<title>User Registration</title>
<style>
.textbox input {
	background:#666666;
	border-bottom:1px solid #333;
	border-left:1px solid #000;
	border-right:1px solid #333;
	border-top:1px solid #000;
	color:#fff;
	border-radius: 3px 3px 3px 3px;
	-moz-border-radius: 3px;
	-webkit-border-radius: 3px;
	font:13px Arial, Helvetica, sans-serif;
	padding:6px 6px 4px;
	width:200px;
}

#dis {
	text-align:center;
	height: 25px;
	width: 250px;
	background-color:#46DAFF;
	color:#000;
        font-size: 11px;
        line-height: 18px;
}
#tex {
	width:250px;
	float: left;
	color: #999999;
	font-size: 11px;
	line-height: 18px;
}
body {
    font-family: "DejaVu Sans",Arial,Helvetica,sans-serif;
}
</style>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="../lib/ODSA.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    $('#submit').click(function(){
	console.log(window.serverURL);
        var user=$('#user').val();
        var pass=$('#pass').val();
        var rpass=$('#rpass').val();
        var email=$('#email').val();

        if(user=="")
        {
            $('#dis').slideDown().html("<span>Please type Username</span>");
            return false;
        }
        if(pass=="")
        {
            $('#dis').slideDown().html('<span id="error">Please type Password</span>');
	    return false;
 	}
	if(rpass=="")
	{
 	    $('#dis').slideDown().html('<span id="error">Again type Password</span>');
	    return false;
	}
	if(pass!=rpass)
	{
	    $('#dis').slideDown().html('<span id="error">Password mismatch</span>');
	    return false;
	} 
	if(email=="")
	{
	    $('#dis').slideDown().html('<span id="error">Please type email</span>');
	    return false;
  	}

	var filter = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
	if(!filter.test(email))
	{
	    $('#dis').slideDown().html('<span id="error">Please type correct email</span>');
	    return false;
	}
        jQuery.ajax({
        url:   window.parent.serverURL + "/api/v1/newuser/",
        type:  "POST",
        data: JSON.stringify({"username":  user, "password": pass, "email": email  }),
        processData: false,
        contentType: "application/json; charset=utf-8",
        datatype: "json",
        xhrFields: {withCredentials: true},
        success: function (data) {
            $('#dis').slideDown().html('<span style="background-color: yellow;">Your registration is now completed. Close this window and login inside the OpenDSA main page.</span>');
        }, 
        error: function (data) { 
             $('#dis').slideDown().html('<span id="error">A user with that username already exists.</span>');
        }       
        });  
        return false;  
    });
});
</script> 
</head>
<body>
<fieldset style="width:290px;border:none;" class="textbox">
<form method="post" action="">
<label id="dis" style="width:240px;min-height: 50px;vertical-align: top;"></label><br>
<div id="tex">Username:</div>
<input type="text" id="user" placeholder="Username"/><br /><br />

<div id="tex">Password:</div>
<input type="password" id="pass" placeholder="Password"/><br /><br />

<div id="tex">Re-type Password:</div>
<input type="password" id="rpass" placeholder="Password"/><br /><br />

<div id="tex">Email:</div>
<input type="text" id="email" placeholder="Email"><br /><br />

<p>
<button type="button" id="submit" class="regsubmit" />Register &rarr;</button>
</p>
</form>
</fieldset>
</body>
</html>
